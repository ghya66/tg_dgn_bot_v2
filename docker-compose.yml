services:
  redis:
    image: redis:7-alpine
    restart: unless-stopped
    ports:
      - "6379:6379"
    command: ["redis-server", "--save", "", "--appendonly", "no"]

  bot_primary:
    build: .
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - REDIS_HOST=redis
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - USE_WEBHOOK=${USE_WEBHOOK:-true}
      - BOT_SERVICE_HOST=0.0.0.0
      - BOT_SERVICE_PORT=${BOT_PRIMARY_PORT:-8080}
      - BOT_WEBHOOK_URL=${BOT_PRIMARY_WEBHOOK_URL:-https://your-domain.com/bot-primary}
      - BOT_INSTANCE_NAME=primary
    depends_on:
      - redis
    ports:
      - "${BOT_PRIMARY_PORT:-8080}:${BOT_PRIMARY_PORT:-8080}"
    volumes:
      - ./data:/app/data
      - ./tg_bot.db:/app/tg_bot.db

  bot_secondary:
    build: .
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - REDIS_HOST=redis
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - USE_WEBHOOK=${USE_WEBHOOK:-true}
      - BOT_SERVICE_HOST=0.0.0.0
      - BOT_SERVICE_PORT=${BOT_SECONDARY_PORT:-8081}
      - BOT_WEBHOOK_URL=${BOT_SECONDARY_WEBHOOK_URL:-https://your-domain.com/bot-secondary}
      - BOT_INSTANCE_NAME=secondary
    depends_on:
      - redis
    ports:
      - "${BOT_SECONDARY_PORT:-8081}:${BOT_SECONDARY_PORT:-8081}"
    volumes:
      - ./data:/app/data
      - ./tg_bot.db:/app/tg_bot.db
