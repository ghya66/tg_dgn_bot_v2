# ğŸ—ï¸ TG DGN Bot å®Œæ•´ç”Ÿäº§æ¶æ„å›¾

**ç”Ÿæˆæ—¶é—´**: 2025-11-26 05:57  
**ç‰ˆæœ¬**: V2.0 æ ‡å‡†åŒ–æ¶æ„  

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TG DGN Bot V2 ç”Ÿäº§ç³»ç»Ÿæ¶æ„                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¤ ç”¨æˆ·å±‚: Telegramå®¢æˆ·ç«¯ â†’ Botäº¤äº’                   â”‚
â”‚  ğŸŒ ç½‘ç»œå±‚: Telegram API â† â†’ Bot Polling/Webhook      â”‚
â”‚  ğŸ¤– åº”ç”¨å±‚: Bot V2 + ModuleRegistry + FastAPI         â”‚
â”‚  ğŸ“¦ ä¸šåŠ¡å±‚: Premium/Energy/Address/Menu/TRXç­‰æ¨¡å—      â”‚
â”‚  ğŸ”§ å·¥å…·å±‚: æ”¯ä»˜/éªŒè¯/æ±‡ç‡/å‘é€/å†…å®¹ç®¡ç†                â”‚
â”‚  ğŸ’¾ æ•°æ®å±‚: SQLiteæ•°æ®åº“ + Redisç¼“å­˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
tg_dgn_bot/                              ã€é¡¹ç›®æ ¹ç›®å½•ã€‘
â”‚
â”œâ”€â”€ ğŸ“‚ src/                              ã€æºä»£ç ä¸»ç›®å½•ã€‘
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ¤– bot_v2.py                    ã€æ–°ç‰ˆBotä¸»å…¥å£ â­ ç”Ÿäº§ä½¿ç”¨ã€‘
â”‚   â”‚   â”œâ”€ ModuleRegistryï¼šæ¨¡å—æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚   â”œâ”€ SafeConversationHandlerï¼šç»Ÿä¸€å¯¹è¯å¤„ç†
â”‚   â”‚   â””â”€ FastAPIï¼šREST APIæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ âš™ï¸ config.py                    ã€å…¨å±€é…ç½®ã€‘
â”‚   â”‚   â”œâ”€ Settingsç±»ï¼šç¯å¢ƒå˜é‡ç®¡ç†
â”‚   â”‚   â”œâ”€ æ•°æ®åº“é…ç½®ï¼šSQLiteè¿æ¥
â”‚   â”‚   â””â”€ Telegramé…ç½®ï¼šBot Tokenã€Webhook
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ’¾ database.py                  ã€æ•°æ®åº“æ¨¡å‹å®šä¹‰ã€‘
â”‚   â”‚   â”œâ”€ SQLAlchemy ORMæ¨¡å‹
â”‚   â”‚   â”œâ”€ è¡¨å®šä¹‰ï¼šusers, orders, configsç­‰
â”‚   â”‚   â””â”€ SessionLocalï¼šæ•°æ®åº“ä¼šè¯å·¥å‚
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ core/                        ã€æ ¸å¿ƒåŸºç¡€è®¾æ–½ â­ V2æ–°å¢ã€‘
â”‚   â”‚   â”œâ”€â”€ base.py                     - BaseModuleåŸºç±»
â”‚   â”‚   â”œâ”€â”€ formatter.py                - MessageFormatteræ¶ˆæ¯æ ¼å¼åŒ–
â”‚   â”‚   â”œâ”€â”€ state_manager.py            - ModuleStateManagerçŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ registry.py                 - ModuleRegistryæ¨¡å—æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ common/                      ã€å…¬å…±ç»„ä»¶ã€‘
â”‚   â”‚   â”œâ”€â”€ conversation_wrapper.py    - SafeConversationHandler â­
â”‚   â”‚   â”‚   â”œâ”€ ç»Ÿä¸€å¯¹è¯å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€ è‡ªåŠ¨å¯¼èˆªå¤„ç†
â”‚   â”‚   â”‚   â””â”€ é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ navigation_manager.py      - NavigationManager â­
â”‚   â”‚   â”‚   â”œâ”€ è·¨æ¨¡å—å¯¼èˆª
â”‚   â”‚   â”‚   â”œâ”€ çŠ¶æ€æ¸…ç†
â”‚   â”‚   â”‚   â””â”€ è¿”å›ä¸»èœå•é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ decorators.py              - è£…é¥°å™¨é›†åˆ
â”‚   â”‚   â”œâ”€â”€ settings_service.py        - åŠ¨æ€é…ç½®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ explorer.py                - åŒºå—é“¾æµè§ˆå™¨é“¾æ¥
â”‚   â”‚   â””â”€â”€ content_helper.py          - å†…å®¹ç®¡ç†åŠ©æ‰‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ modules/                     ã€æ ‡å‡†åŒ–æ¨¡å— â­ V2æ ¸å¿ƒã€‘
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ premium/                 ã€Premiumä¼šå‘˜æ¨¡å— âœ…ã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.py              - ä¸»å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.py             - HTMLæ¶ˆæ¯æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ states.py               - çŠ¶æ€å¸¸é‡
â”‚   â”‚   â”‚   â””â”€â”€ keyboards.py            - é”®ç›˜å¸ƒå±€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ menu/                    ã€ä¸»èœå•æ¨¡å— âœ…ã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.py              - ä¸»å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.py             - HTMLæ¶ˆæ¯æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ states.py               - çŠ¶æ€å¸¸é‡
â”‚   â”‚   â”‚   â””â”€â”€ keyboards.py            - é”®ç›˜å¸ƒå±€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ energy/                  ã€èƒ½é‡æ¨¡å— âœ…ã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.py              - ä¸»å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.py             - HTMLæ¶ˆæ¯æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ states.py               - çŠ¶æ€å¸¸é‡ï¼ˆ7ä¸ªçŠ¶æ€ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ keyboards.py            - é”®ç›˜å¸ƒå±€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ address_query/           ã€åœ°å€æŸ¥è¯¢æ¨¡å— âœ…ã€‘
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.py              - ä¸»å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.py             - HTMLæ¶ˆæ¯æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ states.py               - çŠ¶æ€å¸¸é‡
â”‚   â”‚   â”‚   â””â”€â”€ keyboards.py            - é”®ç›˜å¸ƒå±€
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“‚ trx_exchange/            ã€TRXå…‘æ¢æ¨¡å— ğŸ“‹ è®¡åˆ’ä¸­ã€‘
â”‚   â”‚       â”œâ”€â”€ handler.py              - ä¸»å¤„ç†å™¨ï¼ˆå¾…æ ‡å‡†åŒ–ï¼‰
â”‚   â”‚       â”œâ”€â”€ messages.py             - HTMLæ¶ˆæ¯æ¨¡æ¿ï¼ˆå¾…åˆ›å»ºï¼‰
â”‚   â”‚       â”œâ”€â”€ states.py               - çŠ¶æ€å¸¸é‡ï¼ˆå¾…åˆ›å»ºï¼‰
â”‚   â”‚       â””â”€â”€ keyboards.py            - é”®ç›˜å¸ƒå±€ï¼ˆå¾…åˆ›å»ºï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ api/                         ã€REST APIå±‚ â­ V2æ–°å¢ã€‘
â”‚   â”‚   â”œâ”€â”€ main.py                     - FastAPIåº”ç”¨ä¸»æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.py                     - è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ routes/                  - APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ health.py               - å¥åº·æ£€æŸ¥æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ modules.py              - æ¨¡å—ç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ premium.py              - PremiumåŠŸèƒ½æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ orders.py               - è®¢å•ç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ wallet.py               - é’±åŒ…åŠŸèƒ½æ¥å£
â”‚   â”‚   â””â”€â”€ ğŸ“‚ schemas/                 - Pydanticæ•°æ®æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ premium.py              - Premiumç›¸å…³æ¨¡å‹
â”‚   â”‚       â””â”€â”€ order.py                - è®¢å•ç›¸å…³æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ payments/                    ã€æ”¯ä»˜ç³»ç»Ÿæ ¸å¿ƒã€‘
â”‚   â”‚   â”œâ”€â”€ suffix_manager.py           - åç¼€æ± ç®¡ç†ï¼ˆ0.001-0.999ï¼‰
â”‚   â”‚   â”œâ”€â”€ amount_calculator.py        - é‡‘é¢è®¡ç®—ï¼ˆ3ä½å°æ•°ç²¾åº¦ï¼‰
â”‚   â”‚   â”œâ”€â”€ order.py                    - è®¢å•ç®¡ç†ï¼ˆçŠ¶æ€æœºï¼‰
â”‚   â”‚   â””â”€â”€ payment_processor.py        - æ”¯ä»˜ç¡®è®¤ï¼ˆäº¤æ˜“ç›‘æ§ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ wallet/                      ã€é’±åŒ…ç®¡ç†æ¨¡å—ã€‘
â”‚   â”‚   â”œâ”€â”€ wallet_manager.py           - ä½™é¢ç®¡ç†ï¼ˆå¢å‡/é”å®šï¼‰
â”‚   â”‚   â””â”€â”€ profile_handler.py          - ä¸ªäººä¸­å¿ƒç•Œé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ energy/                      ã€èƒ½é‡æœåŠ¡ - æ—§ç‰ˆä¿ç•™ã€‘
â”‚   â”‚   â”œâ”€â”€ manager.py                  - èƒ½é‡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ client.py                   - APIå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ models.py                   - æ•°æ®æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ trx_exchange/                ã€TRXå…‘æ¢ - æ—§ç‰ˆã€‘
â”‚   â”‚   â”œâ”€â”€ config.py                   - å…‘æ¢é…ç½®
â”‚   â”‚   â”œâ”€â”€ rate_manager.py             - æ±‡ç‡ç®¡ç†
â”‚   â”‚   â””â”€â”€ trx_sender.py               - TRXå‘é€å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ address_query/               ã€åœ°å€æŸ¥è¯¢ - æ—§ç‰ˆä¿ç•™ã€‘
â”‚   â”‚   â”œâ”€â”€ validator.py                - æ³¢åœºåœ°å€éªŒè¯
â”‚   â”‚   â””â”€â”€ explorer.py                 - åŒºå—æµè§ˆå™¨é“¾æ¥
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ rates/                       ã€æ±‡ç‡æœåŠ¡æ¨¡å—ã€‘
â”‚   â”‚   â”œâ”€â”€ service.py                  - OKX APIå¯¹æ¥
â”‚   â”‚   â””â”€â”€ jobs.py                     - å®šæ—¶æ›´æ–°ä»»åŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ bot_admin/                   ã€ç®¡ç†åå°æ¨¡å—ã€‘
â”‚   â”‚   â”œâ”€â”€ handler.py                  - ç®¡ç†é¢æ¿å…¥å£
â”‚   â”‚   â”œâ”€â”€ menus.py                    - ç®¡ç†èœå•ç»“æ„
â”‚   â”‚   â”œâ”€â”€ config_manager.py           - é…ç½®CRUDæ“ä½œ
â”‚   â”‚   â””â”€â”€ audit_log.py                - å®¡è®¡æ—¥å¿—è®°å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ orders/                      ã€è®¢å•ç®¡ç†æ¨¡å—ã€‘
â”‚   â”‚   â””â”€â”€ query_handler.py            - è®¢å•æŸ¥è¯¢/ç­›é€‰/å¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ help/                        ã€å¸®åŠ©ç³»ç»Ÿæ¨¡å—ã€‘
â”‚   â”‚   â””â”€â”€ handler.py                  - åˆ†ç±»å¸®åŠ©/FAQ
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“‚ tasks/                       ã€å®šæ—¶ä»»åŠ¡æ¨¡å—ã€‘
â”‚       â””â”€â”€ order_expiry.py             - è®¢å•è¶…æ—¶å¤„ç†
â”‚
â”œâ”€â”€ ğŸ“‚ tests/                           ã€æµ‹è¯•å¥—ä»¶ã€‘
â”‚   â”œâ”€â”€ conftest.py                     - pytesté…ç½®
â”‚   â”œâ”€â”€ test_core_infrastructure.py     - æ ¸å¿ƒåŸºç¡€è®¾æ–½æµ‹è¯•ï¼ˆ13ä¸ªï¼‰
â”‚   â”œâ”€â”€ test_premium_standard.py        - Premiumæ¨¡å—æµ‹è¯•ï¼ˆ11ä¸ªï¼‰
â”‚   â”œâ”€â”€ test_menu_standard.py           - ä¸»èœå•æ¨¡å—æµ‹è¯•ï¼ˆ11ä¸ªï¼‰
â”‚   â”œâ”€â”€ test_energy_standard.py         - èƒ½é‡æ¨¡å—æµ‹è¯•ï¼ˆ15ä¸ªï¼‰
â”‚   â”œâ”€â”€ test_address_query_standard.py  - åœ°å€æŸ¥è¯¢æµ‹è¯•ï¼ˆ11ä¸ªï¼‰
â”‚   â””â”€â”€ test_bot_v2.py                  - Bot V2é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“‚ scripts/                         ã€å®ç”¨è„šæœ¬ã€‘
â”‚   â”œâ”€â”€ start_bot.sh                    - å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ stop_bot.sh                     - åœæ­¢è„šæœ¬
â”‚   â”œâ”€â”€ backup_dbs.py                   - æ•°æ®åº“å¤‡ä»½
â”‚   â”œâ”€â”€ validate_config.py              - é…ç½®éªŒè¯
â”‚   â””â”€â”€ init_admin_config.py            - åˆå§‹åŒ–ç®¡ç†é…ç½®
â”‚
â”œâ”€â”€ ğŸ“‚ docs/                            ã€æ–‡æ¡£ç›®å½•ã€‘
â”‚   â”œâ”€â”€ NEW_ARCHITECTURE.md             - æ–°æ¶æ„è¯´æ˜
â”‚   â”œâ”€â”€ CURRENT_STATUS.md               - é¡¹ç›®çŠ¶æ€
â”‚   â”œâ”€â”€ MIGRATION_GUIDE.md              - è¿ç§»æŒ‡å—
â”‚   â”œâ”€â”€ DEPLOYMENT.md                   - éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ API_REFERENCE.md                - APIæ–‡æ¡£
â”‚   â”œâ”€â”€ QUICK_START.md                  - å¿«é€Ÿå¼€å§‹
â”‚   â”œâ”€â”€ STANDARDIZATION_SUMMARY_2025-11-26.md - æ ‡å‡†åŒ–æ€»ç»“
â”‚   â””â”€â”€ ğŸ“‚ archive/                     - å†å²æ–‡æ¡£å½’æ¡£
â”‚       â”œâ”€â”€ fixes_2025-11-26/           - ä¿®å¤è®°å½•
â”‚       â”œâ”€â”€ deployment/                 - éƒ¨ç½²æ–‡æ¡£
â”‚       â””â”€â”€ premium_v2/                 - Premium V2æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“‚ migrations/                      ã€æ•°æ®åº“è¿ç§»ã€‘
â”‚   â”œâ”€â”€ env.py                          - Alembicç¯å¢ƒ
â”‚   â””â”€â”€ versions/                       - ç‰ˆæœ¬å†å²
â”‚
â”œâ”€â”€ ğŸ“‚ backup_db/                       ã€æ•°æ®åº“å¤‡ä»½ã€‘
â”‚   â””â”€â”€ *.sqlite                        - è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶
â”‚
â”œâ”€â”€ âš™ï¸ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ .env                            - ç¯å¢ƒå˜é‡ï¼ˆç§å¯†ï¼‰
â”‚   â”œâ”€â”€ .env.example                    - ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚   â”œâ”€â”€ requirements.txt                - Pythonä¾èµ–
â”‚   â”œâ”€â”€ pytest.ini                      - æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ alembic.ini                     - æ•°æ®åº“è¿ç§»é…ç½®
â”‚
â”œâ”€â”€ ğŸ’¾ tg_bot.db                        ã€ä¸»æ•°æ®åº“æ–‡ä»¶ã€‘
â”‚   â”œâ”€ users                            - ç”¨æˆ·è¡¨
â”‚   â”œâ”€ orders                           - è®¢å•è¡¨
â”‚   â”œâ”€ energy_orders                    - èƒ½é‡è®¢å•
â”‚   â”œâ”€ trx_exchange_orders              - TRXè®¢å•
â”‚   â”œâ”€ address_query_logs               - æŸ¥è¯¢æ—¥å¿—
â”‚   â”œâ”€ audit_logs                       - å®¡è®¡æ—¥å¿—
â”‚   â””â”€ configs                          - é…ç½®è¡¨
â”‚
â”œâ”€â”€ ğŸ“„ README.md                        ã€é¡¹ç›®è¯´æ˜ã€‘
â””â”€â”€ ğŸ“„ QUICK_REFERENCE.md               ã€å¿«é€Ÿå‚è€ƒã€‘
```

---

## ğŸ¯ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. æ ‡å‡†åŒ–æ¨¡å—ï¼ˆsrc/modules/ï¼‰â­
**è¯´æ˜**: V2æ–°æ¶æ„çš„æ ¸å¿ƒï¼Œæ‰€æœ‰æ¨¡å—éµå¾ªç»Ÿä¸€æ ‡å‡†

**ç‰¹ç‚¹**:
- ç»§æ‰¿BaseModuleåŸºç±»
- ä½¿ç”¨SafeConversationHandler
- ä½¿ç”¨NavigationManager
- HTMLæ¶ˆæ¯æ ¼å¼
- å®Œæ•´çš„æµ‹è¯•è¦†ç›–

**å·²å®Œæˆæ¨¡å—**:
- âœ… Premiumï¼ˆä¼šå‘˜æœåŠ¡ï¼‰
- âœ… Menuï¼ˆä¸»èœå•ï¼‰
- âœ… Energyï¼ˆèƒ½é‡å…‘æ¢ï¼‰
- âœ… Address Queryï¼ˆåœ°å€æŸ¥è¯¢ï¼‰

### 2. æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆsrc/core/ï¼‰â­
**è¯´æ˜**: æä¾›æ ‡å‡†åŒ–æ¨¡å—çš„åŸºç¡€æ”¯æŒ

**ç»„ä»¶**:
- BaseModuleï¼šæ‰€æœ‰æ¨¡å—çš„çˆ¶ç±»
- MessageFormatterï¼šç»Ÿä¸€æ¶ˆæ¯æ ¼å¼åŒ–
- ModuleStateManagerï¼šçŠ¶æ€ç®¡ç†
- ModuleRegistryï¼šæ¨¡å—æ³¨å†Œä¸­å¿ƒ

### 3. å…¬å…±ç»„ä»¶ï¼ˆsrc/common/ï¼‰â­
**è¯´æ˜**: è·¨æ¨¡å—å…±äº«çš„å·¥å…·å’ŒæœåŠ¡

**æ ¸å¿ƒå·¥å…·**:
- SafeConversationHandlerï¼šç»Ÿä¸€å¯¹è¯å¤„ç†
- NavigationManagerï¼šç»Ÿä¸€å¯¼èˆªç®¡ç†
- decoratorsï¼šè£…é¥°å™¨é›†åˆ
- settings_serviceï¼šåŠ¨æ€é…ç½®æœåŠ¡

### 4. REST APIå±‚ï¼ˆsrc/api/ï¼‰â­
**è¯´æ˜**: æä¾›HTTPæ¥å£è®¿é—®BotåŠŸèƒ½

**åŠŸèƒ½**:
- FastAPIæ¡†æ¶
- APIè®¤è¯ï¼ˆX-API-Keyï¼‰
- è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ
- å®Œæ•´çš„ä¸šåŠ¡æ¥å£

### 5. æ”¯ä»˜ç³»ç»Ÿï¼ˆsrc/payments/ï¼‰
**è¯´æ˜**: å¤„ç†æ‰€æœ‰æ”¯ä»˜ç›¸å…³é€»è¾‘

**åŠŸèƒ½**:
- åç¼€æ± ç®¡ç†ï¼ˆå”¯ä¸€é‡‘é¢ï¼‰
- é‡‘é¢è®¡ç®—ï¼ˆ3ä½å°æ•°ï¼‰
- è®¢å•çŠ¶æ€æœº
- æ”¯ä»˜ç¡®è®¤

### 6. æ—§ç‰ˆæ¨¡å—ï¼ˆsrc/energy/, src/trx_exchange/ç­‰ï¼‰
**è¯´æ˜**: ä¿ç•™çš„æ—§ç‰ˆæ¨¡å—ï¼Œæä¾›å‘åå…¼å®¹

**çŠ¶æ€**: 
- åŠŸèƒ½æ­£å¸¸
- é€æ­¥è¿ç§»åˆ°æ ‡å‡†åŒ–æ¨¡å—
- ä¿ç•™å·¥å…·ç±»ï¼ˆmanager, clientç­‰ï¼‰

---

## ğŸ“Š æ•°æ®åº“ç»“æ„

```
tg_bot.db (SQLite)
â”œâ”€â”€ users                           ã€ç”¨æˆ·è¡¨ã€‘
â”‚   â”œâ”€ user_id (PK)                 - Telegramç”¨æˆ·ID
â”‚   â”œâ”€ username                     - ç”¨æˆ·å
â”‚   â”œâ”€ balance                      - é’±åŒ…ä½™é¢
â”‚   â”œâ”€ is_premium                   - æ˜¯å¦Premiumä¼šå‘˜
â”‚   â””â”€ premium_expires_at           - ä¼šå‘˜åˆ°æœŸæ—¶é—´
â”‚
â”œâ”€â”€ orders                          ã€é€šç”¨è®¢å•è¡¨ã€‘
â”‚   â”œâ”€ order_id (PK)                - è®¢å•ID
â”‚   â”œâ”€ user_id (FK)                 - ç”¨æˆ·ID
â”‚   â”œâ”€ order_type                   - è®¢å•ç±»å‹
â”‚   â”œâ”€ status                       - è®¢å•çŠ¶æ€
â”‚   â”œâ”€ amount                       - é‡‘é¢
â”‚   â””â”€ created_at                   - åˆ›å»ºæ—¶é—´
â”‚
â”œâ”€â”€ energy_orders                   ã€èƒ½é‡è®¢å•è¡¨ã€‘
â”‚   â”œâ”€ order_id (PK)                - è®¢å•ID
â”‚   â”œâ”€ user_id (FK)                 - ç”¨æˆ·ID
â”‚   â”œâ”€ order_type                   - è®¢å•ç±»å‹ï¼ˆæ—¶é•¿/ç¬”æ•°/é—ªå…‘ï¼‰
â”‚   â”œâ”€ energy_amount                - èƒ½é‡æ•°é‡
â”‚   â”œâ”€ receive_address              - æ¥æ”¶åœ°å€
â”‚   â””â”€ status                       - è®¢å•çŠ¶æ€
â”‚
â”œâ”€â”€ trx_exchange_orders             ã€TRXå…‘æ¢è®¢å•è¡¨ã€‘
â”‚   â”œâ”€ order_id (PK)                - è®¢å•ID
â”‚   â”œâ”€ user_id (FK)                 - ç”¨æˆ·ID
â”‚   â”œâ”€ usdt_amount                  - USDTé‡‘é¢
â”‚   â”œâ”€ trx_amount                   - TRXé‡‘é¢
â”‚   â”œâ”€ rate                         - æ±‡ç‡
â”‚   â””â”€ receive_address              - æ¥æ”¶åœ°å€
â”‚
â”œâ”€â”€ address_query_logs              ã€åœ°å€æŸ¥è¯¢æ—¥å¿—è¡¨ã€‘
â”‚   â”œâ”€ id (PK)                      - æ—¥å¿—ID
â”‚   â”œâ”€ user_id (FK)                 - ç”¨æˆ·ID
â”‚   â”œâ”€ address                      - æŸ¥è¯¢åœ°å€
â”‚   â””â”€ last_query_at                - æŸ¥è¯¢æ—¶é—´
â”‚
â”œâ”€â”€ suffix_allocations              ã€åç¼€åˆ†é…è¡¨ã€‘
â”‚   â”œâ”€ id (PK)                      - åˆ†é…ID
â”‚   â”œâ”€ suffix                       - åç¼€å€¼ï¼ˆ0.001-0.999ï¼‰
â”‚   â”œâ”€ order_id (FK)                - è®¢å•ID
â”‚   â””â”€ allocated_at                 - åˆ†é…æ—¶é—´
â”‚
â”œâ”€â”€ audit_logs                      ã€å®¡è®¡æ—¥å¿—è¡¨ã€‘
â”‚   â”œâ”€ id (PK)                      - æ—¥å¿—ID
â”‚   â”œâ”€ user_id (FK)                 - æ“ä½œç”¨æˆ·ID
â”‚   â”œâ”€ action                       - æ“ä½œç±»å‹
â”‚   â”œâ”€ details                      - æ“ä½œè¯¦æƒ…
â”‚   â””â”€ created_at                   - æ“ä½œæ—¶é—´
â”‚
â””â”€â”€ configs                         ã€é…ç½®è¡¨ã€‘
    â”œâ”€ price_configs                - ä»·æ ¼é…ç½®
    â”œâ”€ content_configs              - å†…å®¹é…ç½®
    â””â”€ setting_configs              - ç³»ç»Ÿè®¾ç½®
```

---

## ğŸ”„ æ•°æ®æµå‘

```
ç”¨æˆ·æ“ä½œ â†’ Telegram API
    â†“
Botæ¥æ”¶æ¶ˆæ¯
    â†“
ModuleRegistryè·¯ç”±åˆ†å‘
    â†“
SafeConversationHandlerå¤„ç†
    â†“
ä¸šåŠ¡æ¨¡å—å¤„ç†ï¼ˆPremium/Energy/ç­‰ï¼‰
    â†“
æ•°æ®åº“æ“ä½œï¼ˆè®¢å•/ç”¨æˆ·/é…ç½®ï¼‰
    â†“
NavigationManagerå¯¼èˆªç®¡ç†
    â†“
MessageFormatteræ ¼å¼åŒ–å“åº”
    â†“
å‘é€ç»™ç”¨æˆ·
```

---

## ğŸ¯ æ¨¡å—å®ŒæˆçŠ¶æ€

| æ¨¡å— | çŠ¶æ€ | æµ‹è¯• | è¯´æ˜ |
|------|------|------|------|
| Premium | âœ… | 11/11 | ä¼šå‘˜æœåŠ¡ |
| Menu | âœ… | 11/11 | ä¸»èœå• |
| Energy | âœ… | 15/15 | èƒ½é‡å…‘æ¢ |
| Address Query | âœ… | 10/11 | åœ°å€æŸ¥è¯¢ |
| TRX Exchange | ğŸ“‹ | 0/0 | è®¡åˆ’ä¸­ |
| Wallet | ğŸ“‹ | 0/0 | è®¡åˆ’ä¸­ |
| Admin | ğŸ“‹ | 0/0 | è®¡åˆ’ä¸­ |
| Help | ğŸ“‹ | 0/0 | è®¡åˆ’ä¸­ |

**æ€»è¿›åº¦**: 50% (4/8æ¨¡å—å®Œæˆ)

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-26 05:57  
**ç»´æŠ¤è€…**: TG DGN Bot Team
