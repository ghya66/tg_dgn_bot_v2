# 更新日志

## [Unreleased] - 2025-10-28

### ✨ 新增功能

#### 能量服务（TRX/USDT 直转模式）

- **能量闪租**：用户直接转 TRX 到代理地址，6秒自动到账

  - 支持 6.5万/13.1万能量

  - 1小时有效期

  - 支持 1-20 笔购买

- **笔数套餐**：用户直接转 USDT 到代理地址

  - 最低 5 USDT

  - 弹性扣费：有U扣1笔，无U扣2笔

  - 每天至少使用一次

- **闪兑**：USDT 直接兑换能量，即时到账

### 🔧 功能优化

#### 地址查询改为免费功能

- 移除所有扣费逻辑

- 保留 30 分钟/人限频机制
- 更新提示文案："免费功能"

#### 全局动态配置中心

- Premium / 余额充值 / TRX 兑换 / 能量 模块接入 `order_timeout_minutes` 配置，订单有效期可后台实时调整
- 地址查询限频改为读取 `address_query_rate_limit`，README/PAYMENT_MODES/用户指南同步提示“可配置”
- 新增 TRX 兑换订单 `expires_at` 字段及到期校验测试

#### 代码架构优化

- 移除旧的能量 API 客户端初始化逻辑

- 简化 Bot 主程序依赖
- 使用新的 `handler_direct.py` 直转模式处理器

### 📚 文档更新

- 新增 `docs/PAYMENT_MODES.md` - 支付方式完整文档（600+ 行）

- 新增 `docs/ISSUE5_SUMMARY.md` - Issue #5 实施总结（400+ 行）
- 新增 `docs/IMPLEMENTATION_SUMMARY.md` - 完整实施总结

- 更新 `README.md` - 功能状态和使用说明
- 更新 `AGENTS.md` - 功能实现状态

- 更新 `.env.example` - 添加能量代理地址配置

### 🧪 测试

- 新增 `tests/test_energy_direct.py` - 14 个测试用例（100% 通过）

- 测试覆盖：153 个测试（100% 通过）

### 📊 代码统计

- 新增代码：~1,800 行

- 修改代码：~150 行
- 测试覆盖：153 个测试（100% 通过）

- 文档更新：5 个文件

---

## [1.0.0] - 2025-10-27

### ✨ 首次发布

#### 核心功能

- TRC20 USDT 支付系统（固定地址 + 0.001-0.999 唯一后缀）

- Premium 会员直充（自动交付 Telegram Premium）
- 余额管理系统（充值、扣费、记录查询）

- 地址查询功能（波场地址验证 + 限频）

#### 测试覆盖

- 142 个测试用例（100% 通过）

- 核心功能测试：80 个
- 钱包模块测试：20 个

- 地址查询测试：22 个
- Redis 集成测试：20 个

#### 文档

- 完整的 README.md

- 详细的 .env.example
- 功能说明文档

---

## 版本说明

### 版本号格式

使用 [语义化版本](https://semver.org/lang/zh-CN/)：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的 API 修改

- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 变更类型

- **新增功能** (✨): 新增的功能特性

- **功能优化** (🔧): 对现有功能的改进
- **Bug修复** (🐛): 修复的问题

- **文档更新** (📚): 文档相关的变更
- **测试** (🧪): 测试相关的变更

- **重构** (♻️): 代码重构（不影响功能）
- **性能优化** (⚡): 性能改进

- **安全修复** (🔒): 安全问题修复

---

## 贡献指南

欢迎提交 Issue 和 Pull Request！

提交 PR 时请确保：

1. 所有测试通过（`pytest tests/ -v`）

2. 代码符合 PEP 8 规范
3. 添加必要的测试用例

4. 更新相关文档
5. 在 CHANGELOG.md 中记录变更

---

## 联系方式

- GitHub: [@Jack123-UU](https://github.com/Jack123-UU)

- Issues: [GitHub Issues](https://github.com/Jack123-UU/tg_dgn_bot/issues)
